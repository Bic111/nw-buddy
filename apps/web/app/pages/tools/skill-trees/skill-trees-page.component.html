<ion-header class="bg-base-300">
  <div class="flex flex-col-reverse md:flex-row">
    <ul class="flex flex-row flex-nowrap flex-1 w-full overflow-x-auto scrollbar-hide gap-1">
      <li>
        <button
          [nwbDataCateogryMenu]
          [category]="category()"
          [showCounter]="true"
          [defaultRoute]="''"
          [defaultTitle]="title"
          [routePrefix]="'.'"
          [queryParam]="categoryParam()"
          class="btn btn-ghost normal-case text-left"
        ></button>
      </li>
      <span class="flex-1"></span>
      <li>
        <button class="btn btn-square btn-ghost" [cdkMenuTriggerFor]="tplMenu" [tooltip]="'Filter by tag'">
          <nwb-icon [icon]="iconMore" class="w-5 h-5" />
        </button>
        <ng-template #tplMenu>
          <ul class="menu menu-compact bg-base-100 w-60 rounded-b-md z-10" cdkMenu>
            @for (item of tags(); track $index) {
              <li>
                <a (click)="toggleTag(item.tag)" [class.active]="item.active">
                  {{ item.tag }}
                </a>
              </li>
            }
          </ul>
        </ng-template>
      </li>
      <li>
        <button class="btn btn-square btn-ghost" (click)="createItem()" [tooltip]="'Create new entry'">
          <nwb-icon [icon]="iconCreate" class="w-5 h-5" />
        </button>
      </li>
      <li>
        <button class="btn btn-square btn-ghost" (click)="importItem()" [tooltip]="'Import'">
          <nwb-icon [icon]="iconImport" class="w-5 h-5" />
        </button>
      </li>
    </ul>
    <div class="flex-none p-2 w-full md:max-w-[256px]">
      <nwb-quicksearch-input [autofocus]="true" [placeholder]="'Quickfilter'" />
    </div>
  </div>
</ion-header>
<ion-content [scrollY]="false">
  <ion-split-pane [when]="showSidebar()" contentId="main" style="--side-min-width: 400px;">
    <div class="ion-page order-2" id="main">
      @if (dataView.isGridActive()) {
        <nwb-virtual-grid
          [enableQuickfilter]="true"
          [data]="dataView.categoryItems$ | async"
          [options]="dataView.virtualOptions"
          [identifyBy]="dataView.entityIdGetter"
          [selectionRouteParam]="selectionParam"
        />
      } @else if (dataView.isTableActive()) {
        <nwb-table-grid
          (ready$)="dataView.onTableReady($event)"
          [enableQuickfilter]="true"
          [data]="dataView.categoryItems$ | async"
          [options]="dataView.tableGridOptions"
          [identifyBy]="dataView.entityIdGetter"
          [persistKey]="persistKey"
          [filterQueryParam]="filterParam"
          [selectionRouteParam]="selectionParam"
        />
      }
    </div>
    <ion-menu contentId="main" class="order-2">
      @if (showSidebar()) {
        <ion-content>
          <ng-container *ngTemplateOutlet="tplDetail" />
        </ion-content>
      }
    </ion-menu>
  </ion-split-pane>
  <ion-modal
    [isOpen]="showModal()"
    [initialBreakpoint]="100 | px2vh"
    [breakpoints]="[12 | px2vh, 100 | px2vh, 0.45, 1]"
    [backdropBreakpoint]="0.5"
    [backdropDismiss]="false"
  >
    @if (showModal()) {
      <ion-content class="bg-base-300">
        <ng-container *ngTemplateOutlet="tplDetail" />
      </ion-content>
    }
  </ion-modal>
</ion-content>

<ng-template #tplDetail>
  <router-outlet #outlet="outlet"></router-outlet>
  @if (!outlet.isActivated) {
    <div class="p-4 flex flex-row items-center justify-center">
      <button (click)="createItem()" class="btn btn-primary gap-1">
        <nwb-icon [icon]="iconCreate" class="w-5 h-5" />
        <span>Create New</span>
      </button>
    </div>
  }
</ng-template>

<div class="text-xl text-center bg-base-300 px-2 py-3">Attributes</div>

<nwb-attributes-editor
  [level]="data.level"
  [base]="data.base"
  [assigned]="data.assigned"
  [buffs]="data.buffs"
  [magnify]="data.magnify"
  (assignedChanged)="setResult($event)"
  class="p-3"
  #attrs
></nwb-attributes-editor>

<ng-container *ngIf="data.weapon1ItemId || data.weapon2ItemId">
  <div class="tabs tabs-bordered">
    <a class="tab flex-1" (click)="tab = data.weapon1ItemId" [class.tab-active]="tab && tab === data.weapon1ItemId">
      {{ weapon1.name$ | async | nwText }}
      (
      <span>
        @if(scale1.damageInvalid$ | async; as value) {
          <span class="line-through opacity-50"> {{ value | number: '0.1-1' }} </span>
        }
        @if(scale1.damage$ | async; as value) {
          <span> {{ value | number: '0.1-1' }} </span>
        } @else {
          <span> 0 </span>
        }
      </span>
      )
    </a>

    <a class="tab flex-1" (click)="tab = data.weapon2ItemId" [class.tab-active]="tab && tab === data.weapon2ItemId">
      {{ weapon2.name$ | async | nwText }}
      (
      <span>
        @if(scale2.damageInvalid$ | async; as value) {
          <span class="line-through opacity-50"> {{ value | number: '0.1-1' }} </span>
        }
        @if(scale2.damage$ | async; as value) {
          <span> {{ value | number: '0.1-1' }} </span>
        } @else {
          <span> 0 </span>
        }
      </span>
      )
    </a>
  </div>

  <nwb-attributes-scale
    class="p-1"
    [nwbItemDetail]="data.weapon1ItemId"
    #weapon1="itemDetail"
    #scale1
    [class.hidden]="tab !== data.weapon1ItemId"
    [attrDex]="attrs.totalDex$ | async"
    [attrStr]="attrs.totalStr$ | async"
    [attrInt]="attrs.totalInt$ | async"
    [attrFoc]="attrs.totalFoc$ | async"
    [level]="data.level"
    [weaponItemId]="data.weapon1ItemId"
    [gearScore]="data.weapon1GearScore"
    [affixId]="data.weapon1AffixId"
  />

  <nwb-attributes-scale
    class="p-1"
    [nwbItemDetail]="data.weapon2ItemId"
    #weapon2="itemDetail"
    #scale2
    [class.hidden]="tab !== data.weapon2ItemId"
    [attrDex]="attrs.totalDex$ | async"
    [attrStr]="attrs.totalStr$ | async"
    [attrInt]="attrs.totalInt$ | async"
    [attrFoc]="attrs.totalFoc$ | async"
    [weaponItemId]="data.weapon2ItemId"
    [gearScore]="data.weapon2GearScore"
    [affixId]="data.weapon2AffixId"
  />
</ng-container>

<div class="flex justify-end gap-1 layout-pad">
  <div class="join">
    <label class="join-item btn btn-ghost" (click)="close()">Cancel</label>
  </div>
  <div class="join">
    <label class="join-item btn btn-primary" (click)="commit()">OK</label>
  </div>
</div>

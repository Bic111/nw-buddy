<div class="grid grid-cols-fill-xs gap-x-2 gap-y-1">
  <div class="join bg-base-200">
    <button
      class="join-item btn btn-sm btn-ghost flex-1 text-left justify-start"
      [cdkMenuTriggerFor]="playerLevelSlider"
    >
      Player Level
    </button>
    <input
      type="number"
      class="join-item input input-sm w-20 appearance-none text-right"
      [(ngModel)]="playerLevel"
      [min]="playerLevelMin"
      [max]="playerLevelMax"
      (wheel)="($event)"
    />
    <button class="join-item btn btn-sm btn-ghost btn-square" [tooltip]="playerLevelTip" [preventClick]="true">
      <nwb-icon [icon]="iconInfo" class="w-4 h-4" />
    </button>
    <ng-template #playerLevelTip>
      <div class="p-2 prose prose-sm leading-tight w-80">
        <h4>Player level</h4>
        <p>
          Accounts for player level or player level range condition tags, e.g.
          <span class="badge badge-secondary badge-sm">Player {{ playerLevel || 60 }}</span>
        </p>
      </div>
    </ng-template>
    <ng-template #playerLevelSlider>
      <div class="bg-base-200 border border-base-100 rounded-lg p-4 w-80" cdkMenu>
        <nwb-input-slider
          class="w-full"
          [size]="'xs'"
          [min]="playerLevelMin"
          [max]="playerLevelMax"
          [step]="1"
          [bars]="true"
          [barsStep]="10"
          [values]="true"
          [(ngModel)]="playerLevel"
        />
      </div>
    </ng-template>
  </div>

  <div class="join bg-base-200">
    <button
      class="join-item btn btn-sm btn-ghost flex-1 text-left justify-start"
      [cdkMenuTriggerFor]="contentLevelSlider"
    >
      Content Level
    </button>
    <input
      type="number"
      class="join-item input input-sm w-20 appearance-none text-right"
      [(ngModel)]="minContLevel"
      [min]="contentLevelMin"
      [max]="contentLevelMax"
      (wheel)="($event)"
    />
    <button class="join-item btn btn-sm btn-ghost btn-square" [tooltip]="contentLevelTip" [preventClick]="true">
      <nwb-icon [icon]="iconInfo" class="w-4 h-4" />
    </button>
    <ng-template #contentLevelTip>
      <div class="p-2 prose prose-sm leading-tight w-80">
        <h4>Minimum Content Level</h4>
        <p>
          Accounts for content level condition tags, e.g.
          <span class="badge badge-secondary badge-sm">MinContLevel {{ minContLevel || 60 }}</span>
        </p>
      </div>
    </ng-template>
    <ng-template #contentLevelSlider>
      <div class="bg-base-200 border border-base-100 rounded-lg p-4 w-80" cdkMenu>
        <nwb-input-slider
          class="w-full"
          [size]="'xs'"
          [min]="contentLevelMin"
          [max]="contentLevelMax"
          [step]="1"
          [bars]="true"
          [barsStep]="10"
          [values]="true"
          [(ngModel)]="minContLevel"
        />
      </div>
    </ng-template>
  </div>

  <div class="join bg-base-200">
    <button
      class="join-item btn btn-sm btn-ghost flex-1 justify-start"
      [class.justify-start]="!!vitalId"
      [class.italic]="!vitalId"
      (click)="pickVital()"
    >
      @if (vitalId) {
        @if (vitalIcon; as icon) {
          <img [src]="icon" class="w-6 h-6" />
        }
        {{ vitalName | nwText }}
      } @else {
        Creature
      }
    </button>
    <button class="join-item btn btn-sm btn-ghost btn-square" [tooltip]="creatureTip" [preventClick]="true">
      <nwb-icon [icon]="iconInfo" class="w-4 h-4" />
    </button>
    <ng-template #creatureTip>
      <div class="p-2 prose prose-sm leading-tight w-80">
        The vital level accounts for enemy level condition tag, e.g.
        <span class="badge badge-secondary badge-sm">EnemyLevel {{ vitalLevel || 60 }}</span>
        <br />
        <br />
        Selected creature adds loot tags to context
        <br />
        <!-- <ng-container *ngIf="vm.vital?.tags?.length">
          <br />
          Added Tags:
          <span *ngFor="let tag of vm.vital.tags" class="badge badge-sm badge-secondary mx-1">{{ tag }}</span>
        </ng-container> -->
      </div>
    </ng-template>
  </div>

  <div class="join bg-base-200">
    <button
      class="join-item btn btn-sm btn-ghost flex-1 text-left justify-start"
      [cdkMenuTriggerFor]="enemyLevelSlider"
    >
      Enemy Level
    </button>
    <input
      type="number"
      class="join-item input input-sm w-20 appearance-none text-right"
      [(ngModel)]="vitalLevel"
      [min]="enemyLevelMin"
      [max]="enemyLevelMax"
      (wheel)="($event)"
    />
    <button class="join-item btn btn-sm btn-ghost btn-square" [tooltip]="enemyLevelTip" [preventClick]="true">
      <nwb-icon [icon]="iconInfo" class="w-4 h-4" />
    </button>
    <ng-template #enemyLevelTip>
      <div class="p-2 prose prose-sm leading-tight w-80">
        <h4>Enemy Level</h4>
        <p>
          Accounts for enemy level condition tags, e.g.
          <span class="badge badge-secondary badge-sm">EnemyLevel {{ vitalLevel || 60 }}</span>
        </p>
      </div>
    </ng-template>
    <ng-template #enemyLevelSlider>
      <div class="bg-base-200 border border-base-100 rounded-lg p-4 w-80" cdkMenu>
        <nwb-input-slider
          class="w-full"
          [size]="'xs'"
          [min]="enemyLevelMin"
          [max]="enemyLevelMax"
          [step]="1"
          [bars]="true"
          [barsStep]="10"
          [values]="true"
          [(ngModel)]="vitalLevel"
        />
      </div>
    </ng-template>
  </div>

  <div class="join bg-base-200">
    <button
      class="join-item btn btn-sm btn-ghost flex-1 flex-nowrap truncate"
      [class.justify-start]="!!poiId"
      [class.italic]="!poiId"
      (click)="pickPoi()"
    >
      @if (poiId) {
        @if (poiIcon; as icon) {
          <img [src]="icon" class="w-6 h-6" />
        }
        {{ poiName | nwText }}
      } @else {
        - Point Of Interest -
      }
    </button>

    <button class="join-item btn btn-sm btn-ghost btn-square" [tooltip]="poiTip" [preventClick]="true">
      <nwb-icon [icon]="iconInfo" class="w-4 h-4" />
    </button>
    <ng-template #poiTip>
      <div class="p-2 prose prose-sm leading-tight w-80">
        <h4>Point Of Interest</h4>
        <p>
          Selected POI adds loot tags to context, if it has any.
          <br />
          <!-- <ng-container *ngIf="territory?.tags?.length">
                      <br />
          Added Tags:
          <span *ngFor="let tag of poi.tags" class="badge badge-sm badge-secondary mx-1">{{ tag }}</span>
          </ng-container> -->
        </p>
      </div>
    </ng-template>
  </div>

  <div class="join bg-base-200">
    <button class="join-item btn btn-sm btn-ghost flex-1 text-left justify-start" [cdkMenuTriggerFor]="poiLevelSlider">
      Min POI Level
    </button>
    <input
      type="number"
      class="join-item input input-sm w-20 max-w-xs appearance-none text-right"
      [(ngModel)]="minPoiLevel"
      [min]="poiLevelMin"
      [max]="poiLevelMax"
      (wheel)="($event)"
    />
    <button class="join-item btn btn-sm btn-ghost btn-square" [tooltip]="poiLevelTip" [preventClick]="true">
      <nwb-icon [icon]="iconInfo" class="w-4 h-4" />
    </button>
    <ng-template #poiLevelTip>
      <div class="p-2 prose prose-sm leading-tight w-80">
        <h4>Min POI Level</h4>
        <p></p>
      </div>
    </ng-template>
    <ng-template #poiLevelSlider>
      <div class="bg-base-200 border border-base-100 rounded-lg p-4 w-80" cdkMenu>
        <nwb-input-slider
          class="w-full"
          [size]="'xs'"
          [min]="poiLevelMin"
          [max]="poiLevelMax"
          [step]="1"
          [bars]="true"
          [barsStep]="10"
          [values]="true"
          [(ngModel)]="minPoiLevel"
        />
      </div>
    </ng-template>
  </div>

  <div class="join bg-base-200">
    <button
      class="join-item btn btn-sm btn-ghost flex-1 justify-start flex-nowrap truncate"
      [class.justify-start]="!!territoryId"
      [class.italic]="!territoryId"
      (click)="pickTerritory()"
    >
      @if (territoryId) {
        @if (territoryIcon; as icon) {
          <img [src]="icon" class="w-6 h-6" />
        }
        {{ territoryName | nwText }}
      } @else {
        - Territory -
      }
    </button>

    <button class="join-item btn btn-sm btn-ghost btn-square" [tooltip]="territoryTip" [preventClick]="true">
      <nwb-icon [icon]="iconInfo" class="w-4 h-4" />
    </button>
    <ng-template #territoryTip>
      <div class="p-2 prose prose-sm leading-tight w-80">
        <h4>Territory</h4>
        <p>
          Selected territory updates the Content Level and adds loot tags to context
          <br />
          <!-- <ng-container *ngIf="territory?.tags?.length">
            <br />
            Added Tags:
            <span *ngFor="let tag of territory.tags" class="badge badge-sm badge-secondary mx-1">{{ tag }}</span>
          </ng-container> -->
        </p>
      </div>
    </ng-template>
  </div>

  <div class="join bg-base-200">
    <button
      class="join-item btn btn-sm btn-ghost flex-1 justify-start flex-nowrap truncate"
      [class.justify-start]="!!gameModeId"
      [class.italic]="!gameModeId"
      (click)="pickGameMode()"
    >
      @if (gameModeId) {
        @if (gameModeIcon; as icon) {
          <img [src]="icon" class="w-6 h-6" />
        }
        {{ gameModeName | nwText }}
      } @else {
        - Game Mode -
      }
    </button>

    <button class="join-item btn btn-sm btn-ghost btn-square" [tooltip]="gmaeModeTip" [preventClick]="true">
      <nwb-icon [icon]="iconInfo" class="w-4 h-4" />
    </button>
    <ng-template #gmaeModeTip>
      <div class="p-2 prose prose-sm leading-tight w-80">
        <h4>Game Mode</h4>
        <p>
          <br />
          <!-- <ng-container *ngIf="territory?.tags?.length">
            <br />
            Added Tags:
            <span *ngFor="let tag of territory.tags" class="badge badge-sm badge-secondary mx-1">{{ tag }}</span>
          </ng-container> -->
        </p>
      </div>
    </ng-template>
  </div>

  @if (gameModeIsMutable) {
    <div class="join bg-base-200">
      <button class="join-item btn btn-sm btn-ghost flex-1 text-left justify-start">Difficulty</button>
      <input
        type="number"
        class="join-item input input-sm w-20 appearance-none text-right"
        [(ngModel)]="mutaDifficultyId"
        [min]="mutaDifficultyMin"
        [max]="mutaDifficultyMax"
        (wheel)="($event)"
      />
      <button class="join-item btn btn-sm btn-ghost btn-square" [tooltip]="mutaDifficultyTip" [preventClick]="true">
        <nwb-icon [icon]="iconInfo" class="w-4 h-4" />
      </button>
      <ng-template #mutaDifficultyTip>
        <div class="p-2 prose prose-sm leading-tight w-80">
          <h4>Mutation Difficulty</h4>
          <p></p>
        </div>
      </ng-template>
    </div>

    <div class="join bg-base-200">
      <button class="join-item btn btn-sm btn-ghost flex-1 text-left justify-start">Mutation</button>
      <select
        type="number"
        class="join-item input input-sm w-20 min-w-0 appearance-none"
        [(ngModel)]="mutaElementTypeId"
      >
        <option [value]="null" class="italic">- none -</option>
        @for (option of mutaElementTypeOptions(); track $index) {
          <option [value]="option.value">{{ option.label }}</option>
        }
      </select>

      <button class="join-item btn btn-sm btn-ghost btn-square" [tooltip]="mutaElementTip" [preventClick]="true">
        <nwb-icon [icon]="iconInfo" class="w-4 h-4" />
      </button>
      <ng-template #mutaElementTip>
        <div class="p-2 prose prose-sm leading-tight w-80">
          <h4>Mutation Element</h4>
          <p></p>
        </div>
      </ng-template>
    </div>
  }
</div>

<div class="form-control w-full">
  <label class="label">
    <span class="label-text">Selected Tags</span>
  </label>
  <div class="flex flex-row flex-wrap gap-1">
    @for (item of tags | async; track item.tag) {
      <nwb-loot-tag
        @tag
        [tag]="item.tag"
        [checked]="true"
        [actions]="item.editable"
        (removeClicked)="removeTag(item.tag)"
      />
    }
  </div>
</div>
